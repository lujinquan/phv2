<!-- 暂停记租申请 -->
<form class="layui-form" action="" method="post" >
  <div class="j-details-box floorWrap">
	<fieldset class="layui-elem-field layui-field-title j-field-box">
		<legend>基本信息</legend>
	</fieldset>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label"><i class="red">*</i>楼栋编号</label>
			<div class="j-input-inline">
				<input type="text" name="ban_number" value="{$data_info['ban_info']['ban_number']}" placeholder="点击查询"  lay-verify="required" readonly autocomplete="off" class="layui-input">
				<input type="hidden" name="ban_id" value="{$data_info['ban_id']}">
				<input type="hidden" name="house_id" value="{$data_info['house_id']}">
				<input type="hidden" name="id" value="{$data_info['id']}">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">楼栋地址</label>
			<div class="j-input-inline">
				<input type="text" name="ban_address" readonly value="{$data_info['ban_info']['ban_address']}" placeholder="" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">楼栋产别</label>
			<div class="j-input-inline">
				<input type="text" name="ban_owner_id" readonly value="{$params.owners[$data_info['ban_info']['ban_owner_id']]}" placeholder="" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">结构类别</label>
			<div class="j-input-inline">
				<input type="text" name="ban_struct_id" readonly value="{$params.structs[$data_info['ban_info']['ban_struct_id']]}" placeholder="" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">完损等级</label>
			<div class="j-input-inline">
				<input type="text" name="ban_damage_id" readonly value="{$params.damages[$data_info['ban_info']['ban_damage_id']]}" placeholder="" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">暂停月租金</label>
			<div class="j-input-inline">
				<input type="number" name="change_pause_rent" readonly value="{$data_info['change_pause_rent']}" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md8">
			<label class="j-form-label">异动原因</label>
			<div class="j-input-inline">
				<input type="text" name="change_remark" value="{$data_info['change_remark']}" autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
		<legend>房屋明细</legend>
	</fieldset>
	<table  class="layui-table j-house-box">
	  <thead>
		  <tr>
		    <th>房屋编号</th>
		    <th>承租人</th>
		    <th>使用性质</th>
		    <th>规定租金</th>
		    <th>租差</th>
		    <th>泵费</th>
		  </tr>
	  </thead>
	  <tbody>
	  	{volist name="$data_info['data_json']" id="v"}
	    <tr>											
		  <td class="house_number"><input type="hidden" name="house_id[]" value="{$v['house_id']}"> {$v['house_number']}</td>
		  <td class="house_lessee">{$v['tenant_name']}</td>
		  <td class="house_nature">{$params.uses[$v['house_use_id']]}</td>
		  <td class="house_monthly_rent">{$v['house_pre_rent']}</td>
		  <td class="house_monthly_rent">{$v['house_diff_rent']}</td>
		  <td class="house_monthly_rent">{$v['house_pump_rent']}</td>
		</tr>
		{/volist}
	  </tbody>
	</table>
  <div class="layui-row layui-form-item layui-col-space90">
		<div class="j-margin-btn">
			<a href="javascript:history.go(-1)" class="layui-btn layui-btn-primary">取消</a>
			<button type="submit" j-data="{'save_type':'save'}" class="layui-btn" lay-submit lay-filter="formSubmit">保存</button>
			<button type="submit" j-data="{'save_type':'submit'}" class="layui-btn" lay-submit lay-filter="formSubmit">保存并提交</button>
		</div>
	</div>
  </div>
</form>
{include file="system@block/layui" /}
<script type="text/javascript">
	layui.use(['jquery', 'laydate', 'upload', 'form'], function() {
		var laydate = layui.laydate,
			$ = layui.$,
			upload = layui.upload,
			form = layui.form;
			//console.log(params);
		//获取楼栋查询器
		 $(".layui-form").on('click','.j-ban_number',function(){
		layer.open({
					title: '楼栋查询器'
					,type: 2
					,offset: 'auto'
					,area: ['70%', '90%']
					, btn:false
					,pageTabs: false
					,content: '{:url('system/index/cancellation')}?hisi_iframe=yes'
					,btn: ['确定','关闭']
					,yes: function(index, layero){
						var row = window["layui-layer-iframe" + index].callbackdata();
						var rows = window["layui-layer-iframe" + index].callbackdatas();
						var HousePrerent = 0;
						// console.log(row);
						// console.log(rows);
						layer.close(index);
						$('.j-house-box tbody').html("");
							//房屋信息
							if(rows){
								var houseidData = '';
								for(var i=0;i<rows.length;i++) {
								houseidData += ','+rows[i].house_id;
								var trData ='<tr>\
												<td class="house_number">'+rows[i].house_number+'</td>\
												<td class="house_lessee">'+rows[i].tenant_name+'</td>\
												<td class="house_nature">'+params.uses[rows[i].house_use_id]+'</td>\
												<td class="house_pre_rent">'+rows[i].house_pre_rent+'</td>\
												<td class="house_diff_rent">'+rows[i].house_diff_rent+'</td>\
												<td class="house_pump_rent">'+rows[i].house_pump_rent+'</td>\
											</tr>';

								$('.j-house-box tbody').append(trData);

								HousePrerent += parseFloat(rows[i].house_pre_rent) * 100;
							}
							houseidData = houseidData.replace(/^(\s|,)+|(\s|,)+$/g, '');
							$("input[name='house_id']").val(houseidData);//获取房屋编号
							
						}
						//楼栋信息
							$("input[name='ban_number']").val(row.ban_number);//获取楼栋编号
							$("input[name='ban_id']").val(row.ban_id);//获取楼栋id
							$("input[name='ban_address']").val(row.ban_address);//获取楼栋地址
							$("input[name='ban_owner_id']").val(params.owners[row.ban_owner_id]);//获取楼栋产别
							$("input[name='ban_struct_id']").val(params.structs[row.ban_struct_id]);//获取楼栋结构类别
							$("input[name='ban_damage_id']").val(params.damages[row.ban_damage_id]);//获取楼栋完损等级
							$("input[name='change_pause_rent']").val(HousePrerent.toFixed(2) / 100);//获取楼栋暂停月租金
							if(	$('.j-house-box tbody').html()==''){
								$('.j-house-box tbody').html("<tr><td colspan='6'><div class='j-no-content'><i class='layui-icon iconfont j-icon-wushuju'></i>暂无数据！</div></td></tr>");
							}

					},btn2: function(index, layero){
						layer.close(index);
					}
		 });
		})

	});
</script>
