<form class="layui-form" action="" method="post" >
  <div class="j-details-box floorWrap">
	<fieldset class="layui-elem-field layui-field-title j-field-box">
		<legend>基本信息</legend>
	</fieldset>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md12">
			<label class="j-form-label"><i class="red">*</i>房屋编号</label>
			<div class="j-input-inline j-tips">
				<input type="text" id="house_number" lay-verify="required" readonly value="" placeholder="点击查询" autocomplete="off" class="layui-input">
				<input type="hidden" name="ban_id" value="">
				<input type="hidden" name="house_id" value="">
				<input type="hidden" name="tenant_id" value="">
				<b class="j-explain-search j-house_number">查询</b>
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">楼栋编号</label>
			<div class="j-input-inline">
				<input type="text" name="ban_number" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md8">
			<label class="j-form-label">楼栋地址</label>
			<div class="j-input-inline">
				<input type="text" name="ban_address" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">楼栋产别</label>
			<div class="j-input-inline">
				<input type="text" name="ban_owner_id" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">使用性质</label>
			<div class="j-input-inline">
				<input type="text" name="house_use_id" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">完损等级</label>
			<div class="j-input-inline">
				<input type="text" name="ban_damage_id" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
	    <div class="layui-col-md4">
	    	<label class="j-form-label">规定租金</label>
	    	<div class="j-input-inline">
	    		<input type="text" name="house_pre_rent" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
	    	</div>
	    </div>
	    <div class="layui-col-md4">
	    	<label class="j-form-label">使用面积</label>
	    	<div class="j-input-inline">
	    		<input type="text" name="house_use_area" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
	    	</div>
	    </div>
	    <div class="layui-col-md4">
	    	<label class="j-form-label">计租面积</label>
	    	<div class="j-input-inline">
	    		<input type="text" name="house_lease_area" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
	    	</div>
	    </div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">租户姓名</label>
			<div class="j-input-inline">
				<input type="text" name="tenant_name" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">联系电话</label>
			<div class="j-input-inline">
				<input type="text" name="tenant_tel" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">身份证号</label>
			<div class="j-input-inline">
				<input type="text" name="tenant_card" readonly value="" placeholder=""  autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">是否收回</label>
			<div class="j-input-inline j-input-radio">
				<input type="radio" name="is_take_back" value="1" checked title="是">
				<input type="radio" name="is_take_back" value="0" title="否">
			</div>
		</div>
		<div class="layui-col-md8">
			<label class="j-form-label">异动原因</label>
			<div class="j-input-inline">
				<input type="text" id="tenant_reason" name="change_remark" value="" autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>

	<fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
		<legend>异动信息</legend>
	</fieldset>
	<table  class="layui-table j-house-box">
	  <thead>
		  <tr>
		    <th>追加类型</th>
		    <th>以前年</th>
		    <th>以前月</th>
			<th>总金额</th>
		  </tr>
	  </thead>
	 <tbody>
	   <tr>
	 	  <td id="write_type">金额</td>
		  <td id="before_year"><input min="0" step="0.01" type="number" name="before_year_rent" id="before_year_rent" lay-verify="required" value=""  placeholder="请输入追加以前年金额" class="layui-input"></td>
		  <td id="before_month"><input min="0" step="0.01" type="number" name="before_month_rent" id="before_month_rent" lay-verify="required" value="" placeholder="请输入追加以前月金额" class="layui-input"></td>
		  <td id="total_sum">0</td>
	   </tr>
	 </tbody>
	</table>
	<fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
		<legend>填报信息</legend>
	</fieldset>
    <div class="layui-row layui-form-item layui-col-space90">
    	<div class="layui-col-md12">
    		<div class="j-enclosure-upload clearfix">
    			<div class="j-enclosure-label">{if condition="in_array('RentAddPaper',$config['changerentadd_file_upload'])"}<i class="red">*</i>{/if} 票据</div>
    			<div class="j-enclosure-label j-uplode-icon">
    				<i><img src="/static/system/image/Group8.png"></i>点击上传
    				<button type="button" class="layui-btn layui-btn-primary" id="upload_img1">上传图片</button>
    			</div>
    			<div class="layui-form-mid layui-word-aux">限制5M</div>
    		</div>
    		<div class="j-enclosure-imgs clearfix">
    			<div id="upload_img_list1" lay-verify="digital" class="upload_img_list j-viewer-img"> </div>
    		</div>
    	</div>
    	<div class="layui-upload">
    	</div>
    </div>
    {include file="common/submit"}
  <!-- <div class="layui-row layui-form-item layui-col-space90">
		<div class="j-margin-btn">
			<a href="javascript:history.go(-1)" class="layui-btn layui-btn-primary">取消</a>
			<button type="submit" j-data="{'save_type':'save'}" class="layui-btn" lay-submit lay-filter="formSubmit">保存</button>
			<button type="submit" j-data="{'save_type':'submit'}" class="layui-btn" lay-submit lay-filter="formSubmit">保存并提交</button>
		</div>
	</div> -->
  </div>
</form>
{include file="system@block/layui" /}
<!-- 图片查看 -->
<link rel="stylesheet" href="__PUBLIC_JS__/viewer/viewer.min.css?v={:config('hisiphp.version')}">
<script type="text/javascript" src="__PUBLIC_JS__/viewer/viewer-jquery.min.js?v={:config('hisiphp.version')}"></script>
<script type="text/javascript">
	var upurl = "{:url('system/Api/upload')}?input=RentAddPaper&group=change&water=no"; //票据
	var duotu = true; //是否为多图上传true false
	layui.use(['jquery', 'laydate', 'upload', 'form','table'], function() {
		var table = layui.table
		    ,form = layui.form
			,$ = layui.jquery
			,upload = layui.upload
			,layer = layui.layer;
		//限制input输入框字符
		$("input[type=number]").keypress(function(e) {
		　　if (!String.fromCharCode(e.keyCode).match(/[0-9\.]/)) {
		　　　　return false;
		　　}
		});
		//获取房屋查询器
		 $(".layui-form").on('click','.j-house_number',function(){
			layer.open({
					title: '房屋查询器'
					,type: 2
					,offset: 'auto'
					,area: ['70%', '60%']
					, btn:false
					,pageTabs: false
					,content: '{:url('system/index/house')}?change_type=11&hisi_iframe=yes'
					,btn: ['确定','关闭']
					,yes: function(index, layero){
						var row = window["layui-layer-iframe" + index].hoesedata();
						if(row.color_status != 1){ //正常状态下的才可以执行
						    layer.msg("当前数据不可选！");
							return false;
						}
						layer.close(index);
						$("#house_number").val(row.house_number);//获取房屋编号
						$("input[name='house_id']").val(row.house_id);//获取房屋id
						$("input[name='ban_id']").val(row.ban_id);//获取楼栋编号
						$("input[name='tenant_id']").val(row.tenant_id);//获取房屋编号
						$("input[name='ban_number']").val(row.ban_number);//获取楼栋编号
						$("input[name='ban_address']").val(row.ban_address);//获取楼栋地址
						$("input[name='ban_owner_id']").val(params.owners[row.ban_owner_id]);//获取楼栋产别
						$("input[name='house_use_id']").val(params.uses[row.house_use_id]);//获取使用性质
						$("input[name='ban_damage_id']").val(params.damages[row.ban_damage_id]);//获取完损等级
						$("input[name='house_pre_rent']").val(row.house_pre_rent);//获取规定租金
						$("input[name='house_use_area']").val(row.house_use_area);//获取使用面积
						$("input[name='house_lease_area']").val(row.house_lease_area);//获取计租面积
						$("input[name='tenant_name']").val(row.tenant_name);//获取租户姓名
						$("input[name='tenant_tel']").val(row.tenant_tel);//获取联系电话
						$("input[name='tenant_card']").val(row.tenant_card);//获取身份证号码
						
						// $("#house_numbers").text(row.house_number);//获取房屋编号
						// $("#building_address").text(row.ban_address);//获取楼栋地址
						// $("#mechanism").text(params.insts[row.ban_inst_id]);//获取机构
						// $("#yield_differentiation").text(params.owners[row.ban_owner_id]);//获取产别
						// $("#nature_usage").text(params.uses[row.house_use_id]);//获取使用性质
						// $("#tenant_name").text(row.tenant_name);//获取租户姓名
						// $("#prescribed_rent").text(row.house_pre_rent);//获取规定租金

					},btn2: function(index, layero){
						layer.close(index);
					}
			 });
		})	
		//计算总金额
		function initialvalue(){
			var i = 0;
			if($("#before_year_rent").val() != ''){
				i = parseFloat($("#before_year_rent").val()).toFixed(2)*100;
			}
			var j = 0;
			if($("#before_month_rent").val() != ''){
				j = parseFloat($("#before_month_rent").val()).toFixed(2)*100;
			}

			$("#total_sum").text((i+j).toFixed(2)/100);
		}
		$("#before_year_rent,#before_month_rent").bind("input propertychange",function(){
			initialvalue();
		});
		// $(".j-submit").click(function(){
		// 	if ($("#upload_img_list1 .item_img").length) {
		// 	   // form.on("submit(formSubmit)", function(data){
		// 	   //     return true;                                               
		// 	   // });

		// 	   // $(this).siblings().prop('disabled', true); //异动里面单独加的
		// 	   //j_submit();
		// 	}
		// 	else{
		// 		layer.msg("票据必须上传！");
		// 		form.on("submit(formSubmit)", function(data){
		// 		    return false;                                               
		// 		});
		// 	}
		// })
		
		//身份证信息
		upload.render({
			elem: '#upload_img1',
			url: upurl,
			size: 1024*5,
			multiple: duotu,
			field: 'RentAddPaper',
			before: function(obj) {
				layer.msg('图片上传中...', {
					icon: 16,
					shade: 0.01,
					time: 0
				})
			},
			done: function(res) {
				layer.close(layer.msg()); //关闭上传提示窗口
				if (duotu == true) {
					//调用多图上传方法,其中res.imgid为后台返回的一个随机数字
					$('#upload_img_list1').append('<dd class="item_img" id="' + res.data.name +
						'"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
						'" class="img" ><input type="hidden" name="RentAddPaper[]" value="' + res.data.id + '" /></dd>');
				} else {
					//调用单图上传方法,其中res.imgid为后台返回的一个随机数字
					$('#upload_img_list1').html('<dd class="item_img" id="' + res.data.name +
						'"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
						'" class="img" ><input type="hidden" name="RentAddPaper[]" value="' + res.data.id + '" /></dd>');
				}
			},
		})
		/*
		删除上传图片
		*/
		$(document).on("click", ".upload_img_list dd i", function() {
			$(this).parents("dd").remove();
		})
		
	});
</script>
