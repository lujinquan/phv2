<!-- 新发租审批页面 -->
<form class="layui-form" action="" method="post" >
  <div class="j-details-box floorWrap">
	<fieldset class="layui-elem-field layui-field-title j-field-box">
		<legend>基本信息</legend>
	</fieldset>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label"><i class="red">*</i>房屋编号</label>
			<div class="j-input-inline">
				<input type="text" value="1234567895" placeholder="点击查询"  lay-verify="required" readonly autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md8">
			<label class="j-form-label">楼栋地址</label>
			<div class="j-input-inline">
				<input type="text" value="解放路486" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">发租类型</label>
			<div class="j-input-inline">
				<input type="text" value="接管" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">单元号</label>
			<div class="j-input-inline">
				<input type="text" value="1" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">层次</label>
			<div class="j-input-inline">
				<input type="text" value="2" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">门牌号</label>
			<div class="j-input-inline">
				<input type="text" value="201" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">租户</label>
			<div class="j-input-inline">
				<input type="text" value="王为樑" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">身份证号</label>
			<div class="j-input-inline">
				<input type="text" value="420106196310242013" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">联系电话</label>
			<div class="j-input-inline">
				<input type="text" value="13657205418" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
    <div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">产别</label>
			<div class="j-input-inline">
				<input type="text" value="区属" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">使用性质</label>
			<div class="j-input-inline">
				<input type="text" value="住宅" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">建筑面积</label>
			<div class="j-input-inline">
				<input type="text" value="100.00" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">计租面积</label>
			<div class="j-input-inline">
				<input type="text" value="49.66" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">房屋原价</label>
			<div class="j-input-inline">
				<input type="text" value="1000000" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">规定租金</label>
			<div class="j-input-inline">
				<input type="text" value="74.50" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">月租金</label>
			<div class="j-input-inline">
				<input type="text" value="74.50" placeholder=""   readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">计租表</label>
			<div class="j-input-inline">
				<input type="text" name="reduction_rentlist" value="" placeholder="双击查看"   readonly autocomplete="off" class="layui-input j-rent-list">
			</div>
		</div>
	</div>
  <fieldset class="layui-elem-field layui-field-title j-field-box">
  	<legend>填报信息</legend>
  </fieldset>
  <div class="layui-row layui-form-item layui-col-space90">
  	<div class="layui-col-md12">
  		<div class="j-enclosure-upload clearfix">
  			<div class="j-enclosure-label">书面申请报告</div>
  			<div class="j-enclosure-label j-uplode-icon">
  				<i><img src="/static/system/image/Group8.png"></i>点击上传
  				<button type="button" class="layui-btn layui-btn-primary" id="upload_img1">上传图片</button>
  			</div>
  			<div class="layui-form-mid layui-word-aux">限制1M</div>
  		</div>
  		<div class="j-enclosure-imgs clearfix">
  			<div id="upload_img_list1" class="upload_img_list j-viewer-img"> </div>
  		</div>
  	</div>
  	<div class="layui-upload">
  	</div>
  </div>
  <div class="layui-row layui-form-item layui-col-space90">
  	<div class="layui-col-md12">
  		<div class="j-enclosure-upload clearfix">
  			<div class="j-enclosure-label">租约</div>
  			<div class="j-enclosure-label j-uplode-icon">
  				<i><img src="/static/system/image/Group8.png"></i>点击上传
  				<button type="button" class="layui-btn layui-btn-primary" id="upload_img2">上传图片</button>
  			</div>
  			<div class="layui-form-mid layui-word-aux">限制1M</div>
  		</div>
  		<div class="j-enclosure-imgs clearfix">
  			<div id="upload_img_list2" class="upload_img_list j-viewer-img"> </div>
  		</div>
  	</div>
  	<div class="layui-upload">
  	</div>
  </div>
  <div class="layui-row layui-form-item layui-col-space90">
  	<div class="layui-col-md12">
  		<div class="j-enclosure-label clearfix">书面申请报告</div>
  		<div class="j-enclosure-img j-viewer-img clearfix">
  			<ul>
  				<li>
  					<img src="/upload/ban/image/20190917/530e20820c40465858863a391626656d.png">
  				</li>
  				<li>
  					<img src="/upload/ban/image/20190917/43e37b86505f7528d20237da2c45d537.png">
  				</li>
  			</ul>
  	    </div>
  	</div>
  </div>
  <div class="layui-row layui-form-item layui-col-space90">
  	<div class="layui-col-md12">
  		<div class="j-enclosure-label clearfix">租约</div>
  		<div class="j-enclosure-img j-viewer-img clearfix">
  			<ul>
  				<li>
  					<img src="/upload/ban/image/20190917/530e20820c40465858863a391626656d.png">
  				</li>
  				<li>
  					<img src="/upload/ban/image/20190917/43e37b86505f7528d20237da2c45d537.png">
  				</li>
  			</ul>
  	    </div>
  	</div>
  </div>
  <div class="layui-row layui-form-item layui-col-space90">
  	<div class="j-margin-btn">
  		<a href="javascript:;" class="layui-btn layui-btn-warm" id="backover">打回</a>
  		<button type="submit" class="layui-btn" lay-submit lay-filter="formSubmit">通过</button>
  		<a href="javascript:;" class="layui-btn layui-btn-danger" id="handover">不通过</a>
  	</div>
  </div>
  </div>
</form>
{include file="system@block/layui" /}
<!-- 图片查看 -->
<link rel="stylesheet" href="__PUBLIC_JS__/viewer/viewer.min.css?v={:config('hisiphp.version')}">
<script type="text/javascript" src="__PUBLIC_JS__/viewer/viewer-jquery.min.js?v={:config('hisiphp.version')}"></script>
<script type="text/javascript">
	/*上传参数设定*/
	var upurl = "{:url('system/Api/upload')}?input=Applicationreport&group=change&water=no"; //书面申请报告
	var upurl1 = "{:url('system/Api/upload')}?input=leaseresidence&group=change&water=no"; //住宅租约
	var duotu = true; //是否为多图上传true false
	//console.log(params);
	layui.use(['jquery', 'laydate', 'upload', 'form'], function() {
		var laydate = layui.laydate,
			$ = layui.$,
			upload = layui.upload,
			form = layui.form;
		//双击查询记租表
		 $(".layui-form").on('click','.j-rent-list',function(){
			 layer.open({
			 			title: '记租表'
			 			,type: 2
			 			,offset: 'auto'
			 			,area: ['70%', '60%']
			 			, btn:false
			 			,pageTabs: false
			 			,content: '{:url('system/index/house')}'
			 			,btn: ['确定','关闭']
			 			,yes: function(index, layero){
			 				layer.close(index);
			 			},btn2: function(index, layero){
			 				layer.close(index);
			 			}
			  });
		 })
        //审批不通过
        $("#handover").on("click",function(){
        	layer.open({
        		type: 1,
        		btn: ["确定","取消"],
        		title: ['审批不通过原因'],
        		scrollbar: false,
        		area: ['400px','200px'],
        		offset: 'auto',
        		content: "<div class='j-open-reason'><input type='text'name='change_reason' class='layui-input' id='change_reason' placeholder='请输入不通过原因！' value=''></div>",
        		yes: function(index, layero){
        			
        			var formData = $('.layui-form').serialize();
        			var data = formData+'&change_reason='+$('#change_reason').val()+'&change_type=3';
        			if($('#change_reason').val()==''){
        				layer.tips('原因不能为空！', '#change_reason', {
        				  tips: 1
        				});
        			}
        			else if(!$('.layui-layer-btn0').hasClass('disabled')){
        				$('.layui-layer-btn0').addClass('disabled').text('提交中...');
        				formSubmit('post',"{:url()}",data,index);
        			}
        
        		}
        	});
        })
        //打回
        $("#backover").on("click",function(){
        	layer.open({
        		type: 1,
        		btn: ["确定","取消"],
        		title: ['打回原因'],
        		scrollbar: false,
        		area: ['400px','200px'],
        		offset: 'auto',
        		content: "<div class='j-open-reason'><input type='text'name='back_reason' class='layui-input' id='back_reason' placeholder='请输入打回原因！' value=''></div>",
        		yes: function(index, layero){
        			
        			var formData = $('.layui-form').serialize();
        			var data = formData+'&back_reason='+$('#back_reason').val()+'&change_type=3';
        			if($('#back_reason').val()==''){
        				layer.tips('原因不能为空！', '#back_reason', {
        				  tips: 1
        				});
        			}
        			else if(!$('.layui-layer-btn0').hasClass('disabled')){
        				$('.layui-layer-btn0').addClass('disabled').text('提交中...');
        				formSubmit('post',"{:url()}",data,index);
        			}
        
        		}
        	});
        })
		//书面申请报告
		upload.render({
			elem: '#upload_img1',
			url: upurl,
			size: 1024,
			multiple: duotu,
			field: 'Applicationreport',
			before: function(obj) {
				layer.msg('图片上传中...', {
					icon: 16,
					shade: 0.01,
					time: 0
				})
			},
			done: function(res) {
				layer.close(layer.msg()); //关闭上传提示窗口
				if (duotu == true) {
					//调用多图上传方法,其中res.imgid为后台返回的一个随机数字
					$('#upload_img_list1').append('<dd class="item_img" id="' + res.data.name +
						'"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
						'" class="img" ><input type="hidden" name="file[]" value="' + res.data.id + '" /></dd>');
				} else {
					//调用单图上传方法,其中res.imgid为后台返回的一个随机数字
					$('#upload_img_list1').html('<dd class="item_img" id="' + res.data.name +
						'"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
						'" class="img" ><input type="hidden" name="file[]" value="' + res.data.id + '" /></dd>');
				}
			}
		})
		//住宅租约
		upload.render({
			elem: '#upload_img2',
			url: upurl1,
			size: 1024,
			multiple: duotu,
			field: 'leaseresidence',
			before: function(obj) {
				layer.msg('图片上传中...', {
					icon: 16,
					shade: 0.01,
					time: 0
				})
			},
			done: function(res) {
				layer.close(layer.msg()); //关闭上传提示窗口
				if (duotu == true) {
					//调用多图上传方法,其中res.imgid为后台返回的一个随机数字
					$('#upload_img_list2').append('<dd class="item_img" id="' + res.data.name +
						'"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
						'" class="img" ><input type="hidden" name="file[]" value="' + res.data.id + '" /></dd>');
				} else {
					//调用单图上传方法,其中res.imgid为后台返回的一个随机数字
					$('#upload_img_list2').html('<dd class="item_img" id="' + res.data.name +
						'"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
						'" class="img" ><input type="hidden" name="file[]" value="' + res.data.id + '" /></dd>');
				}				
			}
		})
		/*
		删除上传图片
		*/
		$(document).on("click", ".upload_img_list dd i", function() {
			$(this).parents("dd").remove();
		})					
	});
	//图片查看
	$('.j-viewer-img').viewer({
	   	url: 'data-original',
	 });
</script>

