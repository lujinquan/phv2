<!-- 暂停计租审批 -->
<form class="layui-form" action="" method="post" >
  <div class="j-details-box floorWrap">
	<fieldset class="layui-elem-field layui-field-title j-field-box">
		<legend>基本信息</legend>
	</fieldset>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">异动编号</label>
			<div class="j-input-inline">
				<input type="text" value="{$data_info['change_order_number']}" readonly class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">楼栋编号</label>
			<div class="j-input-inline">
				<input type="text" value="{$data_info['ban_info']['ban_number']}" readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label"><i class="red">*</i>暂停规定租金</label>
			<div class="j-input-inline">
				<input type="number" value="{$data_info['change_pause_rent']}" readonly autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label">楼栋地址</label>
			<div class="j-input-inline">
				<input type="text" value="{$data_info['ban_info']['ban_address']}" readonly  autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label">楼栋产别</label>
			<div class="j-input-inline">
				<input type="text" value="{$params.owners[$data_info['ban_info']['ban_owner_id']]}" readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md4">
			<label class="j-form-label"><i class="red">*</i>结构类别</label>
			<div class="j-input-inline">
				<input type="text" value="{$params.structs[$data_info['ban_info']['ban_struct_id']]}" readonly autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-col-md4">
			<label class="j-form-label"><i class="red">*</i>完损等级</label>
			<div class="j-input-inline">
				<input type="text" value="{$params.damages[$data_info['ban_info']['ban_damage_id']]}" readonly  autocomplete="off" class="layui-input">
			</div>
		</div>
		
	</div>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md8">
			<label class="j-form-label">异动原因</label>
			<div class="j-input-inline">
				<input type="text" value="{$data_info['change_remark']}" readonly autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
		<legend>房屋明细</legend>
	</fieldset>
	<table  class="layui-table j-house-box">
	  <thead>
		  <tr>
		    <th>房屋编号</th>
		    <th>承租人</th>
		    <th>使用性质</th>
		    <th>规定租金</th>
		    <th>租差</th>
		    <th>泵费</th>
			<th>营业／协议租金</th>
		  </tr>
	  </thead>
	  	<tbody>
		  	{volist name="$data_info['data_json']" id="v"}
		    <tr>											
			  <td class="house_number">{$v['house_number']}</td>
			  <td class="house_lessee">{$v['tenant_name']}</td>
			  <td class="house_nature">{$params.uses[$v['house_use_id']]}</td>
			  <td class="house_monthly_rent">{$v['house_pre_rent']}</td>
			  <td class="house_monthly_rent">{$v['house_diff_rent']}</td>
			  <td class="house_monthly_rent">{$v['house_pump_rent']}</td>
			  <td class="house_agreement_rent">{$v['house_protocol_rent']}</td>
			</tr>
			{/volist}
	 	</tbody>
	</table>
	<fieldset class="layui-elem-field layui-field-title j-field-box">
  	<legend>资料</legend>
  </fieldset>
  <div class="layui-row layui-form-item layui-col-space90">
  	<div class="layui-col-md12">
  		<div class="j-enclosure-label clearfix">拆迁或征收红线图</div>
  		<div class="j-enclosure-img j-viewer-img clearfix">
  			<ul>
				{volist name="$data_info['change_imgs']" id="v"}
				{if condition="$v['file_type'] == 'ChangepauseRedline'"}
				<li>
  					<img src="{$v['file']}" class="img">
  				</li>
				{/if}
				{/volist}
  			</ul>
  	    </div>
  	</div>
  </div>
  <div class="layui-row layui-form-item layui-col-space90">
  	<div class="layui-col-md12">
  		<div class="j-enclosure-label clearfix">拆迁或征收范围明细</div>
  		<div class="j-enclosure-img j-viewer-img clearfix">
  			<ul>
				{volist name="$data_info['change_imgs']" id="v"}
				{if condition="$v['file_type'] == 'ChangepauseRange'"}
				<li>
  					<img src="{$v['file']}" class="img">
  				</li>
				{/if}
				{/volist}
  			</ul>
  	    </div>
  	</div>
  </div>
	<fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
		 <legend>上传报告</legend>
	</fieldset>
	<div class="layui-row layui-form-item layui-col-space90">
		<div class="layui-col-md12">
			{if condition="$data_info['change_status'] == 3"}
			<div class="j-enclosure-upload clearfix">
				<div class="j-enclosure-label">{if condition="in_array('ChangePauseUpload',$config['changepause_file_upload'])"}<i class="red">*</i>{/if} 资料上传</div>
				<div class="j-enclosure-label j-uplode-icon">
					<i><img src="/static/system/image/Group8.png"></i>点击上传
					<button type="button" class="layui-btn layui-btn-primary" id="upload_img1">上传图片</button>
				</div>
				<div class="layui-form-mid layui-word-aux">限制5M</div>
			</div>
			<div class="j-enclosure-imgs clearfix">
	   				<div id="upload_img_list1" class="upload_img_list j-viewer-img">
	   					{volist name="$data_info['change_imgs']" id="v"}
						{if condition="$v['file_type'] == 'ChangePauseUpload'"}
						<dd class="item_img" id="">
							<div class="operate">
								<i  class="layui-icon-close-fill layui-icon"></i>
							</div>
							<img src="{$v['file']}" class="img" ><input type="hidden" name="ChangePauseUpload[]" value="{$v['id']}" />
						</dd>
						{/if}
						{/volist}
	   				</div>
	   			</div>
			{/if}
			<div class="j-enclosure-imgs clearfix">
				<div id="upload_img_list1" class="upload_img_list j-viewer-img"> </div>
				<div class="j-enclosure-img j-viewer-img clearfix">
					<ul>
						{volist name="$data_info['change_imgs']" id="v"}
						{if condition="$v['file_type'] == 'ChangePauseUpload'"}
						<li>
							<img src="{$v['file']}">
						</li>
						{/if}
						{/volist}
					</ul>
			    </div>
			</div>
		</div>
		<div class="layui-upload">
		</div>
	</div>
	
   <fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
	 <legend>审批状态</legend>
   </fieldset>
   <div class="layui-row layui-form-item layui-col-space90">
   	   <div class="j-status-bar">
   		    <ul>
   		        <li class="layui-col-xs2 {if condition="($data_info['change_status'] > 2) || ($data_info['change_status'] == 1)"}on{/if}">
				<i class="layui-icon iconfont j-icon-guifanjieguoyeduigou"></i>
					<p>房管员</p>
				</li>
				<li class="layui-col-xs2 {if condition="($data_info['change_status'] > 3) || ($data_info['change_status'] == 1)"}on{/if}">
					<i class="layui-icon iconfont j-icon-guifanjieguoyeduigou"></i>
					<p>经租会计</p>
				</li>
				<li class="layui-col-xs2 {if condition="($data_info['change_status'] > 4) || ($data_info['change_status'] == 1)"}on{/if}">
					<i class="layui-icon iconfont j-icon-guifanjieguoyeduigou"></i>
					<p>经管所长</p>
				</li>
				<li class="layui-col-xs2 {if condition="($data_info['change_status'] > 5) || ($data_info['change_status'] == 1)"}on{/if}">
					<i class="layui-icon iconfont j-icon-guifanjieguoyeduigou"></i>
					<p>经管科</p>
				</li>
   		    </ul>
   		</div>
   		<div class="j-status-result">
   			<ul>
   				{volist name="$data_info['child_json']" id="v"}
				<li>{$systemusers[$v['uid']]['role']['name']}［{$systemusers[$v['uid']]['nick']}］于 {$v['time']} {$v['action']}；</li>
				{/volist}
   			</ul>
   		</div>
   	</div>
   	<!-- <input type="hidden" name="id" value="{$data_info['id']}">
	<span class="j-tip-danger">不通过：异动失效，申请人需要重新填写申请；</span><span class="j-tip-warm">打回：打回到申请人，申请人可修改资料重新提交申请；</span> -->
	{include file="deal@common/process_submit" /}
  	<!-- <div class="layui-row layui-form-item layui-col-space90">
		<div class="j-margin-btn">
			<a href="javascript:history.go(-1)" class="layui-btn layui-btn-primary">返回</a>
			<a href="javascript:;" class="layui-btn layui-btn-danger" id="handover">不通过</a>
			<a href="javascript:;" class="layui-btn layui-btn-warm" id="backover">打回</a>
			<button type="submit" class="layui-btn" j-data="{'flag':'passed'}" lay-submit lay-filter="formSubmit">通过</button>
		</div>
	</div> -->
  </div>
  {include file="deal@common/pop_part_one" /}
</form>
<form class="layui-form" action="" >
	
</from>
{include file="system@block/layui" /}
<!-- 图片查看 -->
<link rel="stylesheet" href="__PUBLIC_JS__/viewer/viewer.min.css?v={:config('hisiphp.version')}">
<script type="text/javascript" src="__PUBLIC_JS__/viewer/viewer-jquery.min.js?v={:config('hisiphp.version')}"></script>
<script type="text/javascript">
	var upurl = "{:url('system/Api/upload')}?input=ChangePauseUpload&group=ban&water=no"; //资料上传
	var duotu = true; //是否为多图上传true false
	layui.use(['jquery', 'laydate', 'upload', 'form'], function() {
		var laydate = layui.laydate,
			$ = layui.$,
			upload = layui.upload,
			form = layui.form;
		layui.form.render('select');
		//审批不通过
	    $("#handover").on("click",function(){
	    	layer.open({
	    		type: 1,
	    		btn: ["确定","取消"],
	    		title: ['审批不通过原因'],
	    		scrollbar: false,
	    		area: ['400px','300px'],
	    		offset: 'auto',
	    		content: $("#j-notpass-box"),
				success:function(layero){
				     var mask = $(".layui-layer-shade");
				     mask.appendTo(layero.parent());
				     //其中：layero是弹层的DOM对象
				},
	    		yes: function(index, layero){
					var formData = $('.layui-form').serialize();
					var data = formData+'&change_type=3&flag=change';
					var changeReasonType = $('#change_reason_type').val(); //打回类型
					var changeReason = $('#change_reason').val(); //打回原因
					if(changeReasonType == ''){
						layer.tips('请选择异动不通过类型！', '#change_reason_type', {
						  tips: 1
						});
						return false;
					}
					if(changeReasonType == 7 && changeReason == ''){
						layer.tips('原因不能为空！', '#change_reason', {
						  tips: 1
						});
						return false;
					}
					if(!$('.layui-layer-btn0').hasClass('disabled')){
						$('.layui-layer-btn0').addClass('disabled').text('提交中...');
						formSubmit('post',"{:url()}",data,index);
					}

				}
			});
	    });
		//监听不通过
		form.on('select(notpass)', function(data){
		   if(data.elem[data.elem.selectedIndex].text==='其他'){
			  $(".j-open-notpass").show();
		   }
		   else{
			  $(".j-open-notpass").hide();
		   }
		});
	    //打回
	    $("#backover").on("click",function(){
	    	layer.open({
	    		type: 1,
	    		btn: ["确定","取消"],
	    		title: ['打回原因'],
	    		scrollbar: false,
	    		area: ['400px','300px'],
	    		offset: 'auto',
	    		content: $('#j-repulse-box'),
				success:function(layero){
				     var mask = $(".layui-layer-shade");
				     mask.appendTo(layero.parent());
				     //其中：layero是弹层的DOM对象
                },
	    		yes: function(index, layero){
					var formData = $('.layui-form').serialize();
					var data = formData+'&change_type=3&flag=back';
					var backReasonType = $('#back_reason_type').val(); //打回类型
					var backReason = $('#back_reason').val(); //打回原因
					
					if(backReasonType == ''){
						layer.tips('请选择异动打回类型！', '#back_reason_type', {
						  tips: 1
						});
						return false;
					}
					if(backReasonType == 7 && backReason == ''){
						layer.tips('原因不能为空！', '#back_reason', {
						  tips: 1
						});
						return false;
					}
					if(!$('.layui-layer-btn0').hasClass('disabled')){
						$('.layui-layer-btn0').addClass('disabled').text('提交中...');
						formSubmit('post',"{:url()}",data,index);
					}

				}
			});
	    });
		//监听打回
		form.on('select(repulse)', function(data){
		   if(data.elem[data.elem.selectedIndex].text==='其他'){
			  $(".j-open-repulse").show();
		   }
		   else{
			  $(".j-open-repulse").hide();
		   }
		});
        //资料上传
        upload.render({
        	elem: '#upload_img1',
        	url: upurl,
        	size: 1024*5,
        	multiple: duotu,
        	field: 'ChangePauseUpload',
        	before: function(obj) {
        		layer.msg('图片上传中...', {
        			icon: 16,
        			shade: 0.01,
        			time: 0
        		})
        	},
        	done: function(res) {
        		layer.close(layer.msg()); //关闭上传提示窗口
        		if (duotu == true) {
        			//调用多图上传方法,其中res.imgid为后台返回的一个随机数字
        			$('#upload_img_list1').append('<dd class="item_img" id="' + res.data.name +
        				'"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
        				'" class="img" ><input type="hidden" name="ChangePauseUpload[]" value="' + res.data.id + '" /></dd>');
        		} else {
        			//调用单图上传方法,其中res.imgid为后台返回的一个随机数字
        			$('#upload_img_list1').html('<dd class="item_img" id="' + res.data.name +
        				'"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
        				'" class="img" ><input type="hidden" name="ChangePauseUpload[]" value="' + res.data.id + '" /></dd>');
        		}
        	}
        })
		/*
		删除上传图片
		*/
		$(document).on("click", ".upload_img_list dd i", function() {
			$(this).parents("dd").remove();
		})
	});
	//图片查看
	$('.j-viewer-img').viewer({
	   	url: 'data-original',
	 });
</script>
