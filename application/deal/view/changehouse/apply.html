<form class="layui-form" action="{url('add')}" method="post">
  <div class="j-details-box  floorWrap">
		<fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
			<legend>基本信息</legend>
		</fieldset>
		<div class="layui-row layui-form-item layui-col-space90">
			<div class="layui-col-md12">
				<label class="j-form-label"><i class="red">*</i>房屋编号</label>
				<div class="j-input-inline j-tips">
					<input type="text" id="house_number" name="house_number" readonly value="" placeholder="点击查询" autocomplete="off" class="layui-input">
					<b class="j-explain-search j-house_number">查询</b>
				</div>
				<div class="layui-form-mid layui-word-aux j-size-class"></div>
			</div>
		</div>
        <div class="layui-row layui-form-item layui-col-space90">
        	<div class="layui-col-md4">
        		<label class="j-form-label">楼栋编号</label>
        		<div class="j-input-inline">
        			<input type="text" name="ban_number" readonly value="" placeholder="" autocomplete="off" class="layui-input">
        		</div>
        	</div>
        	<div class="layui-col-md4">
        		<label class="j-form-label">房屋结构</label>
        		<div class="j-input-inline">
        			<input type="text" name="tenant_number" readonly value="" placeholder="" autocomplete="off" class="layui-input">
        		</div>
        	</div>
        	<div class="layui-col-md4">
        		<label class="j-form-label">楼层数量</label>
        		<div class="j-input-inline">
        			<input type="text" name="house_door" readonly value="" autocomplete="off" class="layui-input">
        		</div>
        	</div>
        </div>
		<div class="layui-row layui-form-item layui-col-space90">
			<div class="layui-col-md4">
				<label class="j-form-label">租户</label>
				<div class="j-input-inline">
					<input type="text" name="house_unit_id" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md4">
				<label class="j-form-label">居住层</label>
				<div class="j-input-inline">
					<input type="text" name="house_floor_layer" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md4">
				<label class="j-form-label">产别</label>
				<div class="j-input-inline">
					<input type="text" name="ban_owner_id" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
		</div>
		<div class="layui-row layui-form-item layui-col-space90">
			<div class="layui-col-md4">
				<label class="j-form-label">房屋地址</label>
				<div class="j-input-inline">
					<input type="text" name="ban_address" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md4">
				<label class="j-form-label">实有面积</label>
				<div class="j-input-inline">
					<input type="text" name="house_oprice" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md4">
				<label class="j-form-label">计租面积</label>
				<div class="j-input-inline">
					<input type="text" name="house_area" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
		</div>
		<div class="layui-row layui-form-item layui-col-space90">
			<div class="layui-col-md4">
				<label class="j-form-label">规定租金</label>
				<div class="j-input-inline">
					<input type="text" name="house_money" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md4">
				<label class="j-form-label">计算租金</label>
				<div class="j-input-inline">
					<input type="text" name="house_unit_id" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md4">
				<label class="j-form-label">租差</label>
				<div class="j-input-inline">
					<input type="text" name="house_floor_id" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
		</div>
		<div class="layui-row layui-form-item layui-col-space90">
			<div class="layui-col-md4">
				<label class="j-form-label">泵费</label>
				<div class="j-input-inline">
					<input type="text" name="pump_fee" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md4">
				<label class="j-form-label">租金减免</label>
				<div class="j-input-inline">
					<input type="text" name="rent_relief" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md4">
				<label class="j-form-label">协议租金</label>
				<div class="j-input-inline">
					<input type="text" name="agreement_rent" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
		</div>
		<div class="layui-row layui-form-item layui-col-space90">
			<div class="layui-col-md4">
				<label class="j-form-label">电梯</label>
				<div class="j-input-inline">
					<input type="text" name="elevator" readonly value="" autocomplete="off" class="layui-input">
				</div>
			</div>
		</div>
		<fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
			<legend>异动明细</legend>
		</fieldset>
		<table  class="layui-table">
		  <thead>
			  <tr>
			    <th width="20%">异动类型</th>
			    <th class="cancel" width="30%">异动前</th>
			    <th class="cancel" width="50%">异动后</th>
			  </tr>
		  </thead>
		  <tbody>
		    <tr>
			  <td>租差</td>
			  <td id="changes_difference_old"></td>
			  <td><input type="number" class="layui-input cancel_change cancel_change_1" id="changes_difference_news" name="changes_difference_news" value="" autocomplete="off"></td>
		    </tr>
			<tr>
			  <td>泵费</td>
			  <td id="changes_pumpfee_old"></td>
			  <td><input type="number" class="layui-input ancel_change cancel_change_4" id="changes_pumpfee_news" name="changes_pumpfee_news" value="" autocomplete="off"></td>
			</tr>
			<tr>
			  <td>协议租金</td>
			  <td id="changes_agreement_old"></td>
			  <td><input type="number" class="layui-input ancel_change cancel_change_4" id="changes_agreement_news" name="changes_agreement_news" value="" autocomplete="off"></td>
			</tr>
		  </tbody>
		</table>
		<fieldset class="layui-elem-field layui-field-title j-field-box">
			<legend>原房间信息</legend>
		</fieldset>
		<table class="layui-table ">
			<thead class="j-table-center">
				<tr>
					<th>房屋类型</th>
					<th>房间编号</th>
					<th>间号</th>
					<th>绑定楼栋</th>
					<th>绑定房屋</th>
					<th>产别</th>
					<th>单元号</th>
					<th>层次</th>
					<th>实有面积</th>
					<th>基价折减</th>
					<th>计租面积</th>
					<th>层次调解率</th>
					<th>计算租金</th>
					<th>状态</th>
				</tr> 
			</thead>
			<tbody  class="j-table-center">
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</tbody>
		</table>
		<fieldset class="layui-elem-field layui-field-title j-field-box">
			<legend>异动后房间信息</legend>
		</fieldset>
		<div class="layui-row">
			  <a href="{:url('house/room/add')}?id=14542" class="layui-btn layui-btn-primary layui-icon layui-icon-add-1 j-iframe-pop" style="color:#0084FF;" hisi-data="{width: '60%', height: '600px'}" title="新增房间">新增房间</a>
		</div>
		<!-- 异动后房间信息 -->
		<table class="layui-table ">
		<thead class="j-table-center">
			<tr>
				<th>房屋类型</th>
				<th>房间编号</th>
				<th>间号</th>
				<th>绑定楼栋</th>
				<th>绑定房屋</th>
				<th>产别</th>
				<th>单元号</th>
				<th>层次</th>
				<th>实有面积</th>
				<th>基价折减</th>
				<th>计租面积</th>
				<th>层次调解率</th>
				<th>计算租金</th>
				<th>状态</th>
				<th>操作</th>
			</tr> 
		</thead>
		<tbody  class="j-table-center">
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td>	
				
					<a href="{:url('room/edit')}?id={$vo['baseinfo']['room_id']}" class="j-iframe-pop" style="color:#1E9FFF;" hisi-data="{width: '1200px', height: '550px'}" title="修改房间"><i class="layui-icon layui-icon-edit table-edit" style="color:#1E9FFF;"></i></a>
					
					<a href="" data-href="{:url('room/del')}?id={$vo['baseinfo']['room_id']}" isreload="y" class="j-tr-del"><i class="layui-icon layui-icon-delete" style="color:#ff3333;"></i></a>
					
					<!-- <a href="{:url('renttable')}?id={{ d.room_id }}" class="layui-btn layui-btn-xs layui-btn-normal"></a>
				    <a href="{:url('renttable')}?id={{ d.room_id }}" class="layui-btn layui-btn-xs layui-btn-normal">租户</a> -->
			    </td>
			</tr>
		</tbody>
	</table>
	<fieldset id="item1" class="layui-elem-field layui-field-title j-field-box">
		<legend>异动信息</legend>
	</fieldset>
	<table  class="layui-table">
	  <thead>
		  <tr>
		    <th>基本情况</th>
			<th class="cancel">户数</th>
		    <th class="cancel">建设面积</th>
		    <th class="cancel">规定租金</th>
		    <th class="cancel">使用面积</th>
		    <th class="cancel">原价</th>
			<th class="cancel">栋数</th>
		  </tr>
	  </thead>
	  <tbody>
	    <tr>
		  <td>异动前</td>
		  <td class="cancel_before_0" id="floor_households"></td>
		  <td class="cancel_before_1" id="floor_prescribed"></td>
		  <td class="cancel_before_2" id="floor_areaofuse"></td>
		  <td class="cancel_before_3" id="floor_builtuparea"></td>
		  <td class="cancel_before_4" id="floor_original"></td>
		  <td class="cancel_before_5" id="floor_buildings"></td>
	    </tr>
		<tr>
		  <td>异动</td>
		  <td id="cancel_before_0edit"></td>
		  <td id="cancel_before_1edit"></td>
		  <td id="cancel_before_2edit"></td>
		  <td id="cancel_before_3edit"></td>
		  <td id="cancel_before_4edit"></td>
		  <td id="cancel_before_5edit"></td>
		</tr>
		<tr>
		  <td>异动后</td>
		  <td class="cancel_after_0" id="changes_floor_households"></td>
		  <td class="cancel_after_1" id="changes_floor_prescribed"></td>
		  <td class="cancel_after_2" id="changes_floor_areaofuse"></td>
		  <td class="cancel_after_3" id="changes_floor_builtuparea"></td>
		  <td class="cancel_after_4" id="changes_floor_original"></td>
		  <td class="cancel_after_5" id="changes_floor_buildings"></td>
		</tr>
	  </tbody>
	</table>
    <div class="layui-row layui-form-item layui-col-space90">
		<div class="j-margin-btn">
			<a href="javascript:history.go(-1)" class="layui-btn layui-btn-primary">取消</a>
			<button type="submit" j-data="{'save_type':'save'}" class="layui-btn" lay-submit lay-filter="formSubmit">保存</button>
			<button type="submit" j-data="{'save_type':'submit'}" class="layui-btn" lay-submit lay-filter="formSubmit">保存并提交</button>
		</div>
	</div>
</div>
</form>
{include file="system@block/layui" /}
<script type="text/javascript">
layui.use(['jquery', 'laydate', 'upload', 'form','table'], function() {
  var table = layui.table
      ,form = layui.form
  	,$ = layui.jquery
  	,upload = layui.upload
  	,layer = layui.layer;
	
	//获取房屋查询器
	 $(".layui-form").on('click','.j-house_number',function(){
		layer.open({
				title: '房屋查询器'
				,type: 2
				,offset: 'auto'
				,area: ['70%', '60%']
				, btn:false
				,pageTabs: false
				,content: '{:url('system/index/house')}'
				,btn: ['确定','关闭']
				,yes: function(index, layero){
					var row = window["layui-layer-iframe" + index].hoesedata();
					console.log(row);
					layer.close(index);
					var hosue_number = row.house_number;
					$("#house_number").val(row.house_number);//获取房屋编号
					$("input[name='ban_number']").val(row.ban_number);//获取楼栋编号
					$("input[name='tenant_number']").val(params.structs[row.ban_struct_id]);//获取房屋结构
					$("input[name='house_door']").val(row.ban_floors);//获取楼层数量
					$("input[name='house_unit_id']").val(row.tenant_name);//获取租户
					$("input[name='house_floor_layer']").val(row.house_floor_id);//获取居住层
					$("input[name='ban_owner_id']").val(params.owners[row.ban_owner_id]);//获取产别
					$("input[name='ban_address']").val(row.ban_address);//获取房屋地址
					$("input[name='house_oprice']").val(row.house_use_area);//获取实有面积
					$("input[name='house_area']").val(row.house_lease_area);//获取计租面积
					$("input[name='house_money']").val(row.house_pre_rent);//获取规定租金
					$("input[name='house_unit_id']").val(row.house_cou_rent);//获取计算租金
					$("input[name='house_floor_id']").val(row.house_diff_rent);//获取租差
					$("input[name='pump_fee']").val(row.house_pump_rent);//获取泵费
					$("input[name='rent_relief']").val(row.house_pump_rent);//获取租金减免(没字段随便取得值)
					$("input[name='agreement_rent']").val(row.house_protocol_rent);//获取协议租金
					$("input[name='elevator']").val(row.ban_is_levator);//获取电梯
					//获取原房间信息
					var house_id = row.house_id;//获取房屋ID
					$.ajax({
					  type: "post",
					  url: "{:url('house/house/renttable')}?id="+house_id,
					  data: { 'house_id': house_id}, 
					  dataType: "json", 
					  success: function(res) {
						  console.log(res);
						if(res.code == 0){
							layer.msg(res.msg);
						}else{
							
						}
						   
					  },
					  error: function(msg) {
						  layer.msg(msg);
					  }
					}); 
				},btn2: function(index, layero){
					layer.close(index);
				}
		 });
	})	
})
</script>